# 서울아산병원 협업평가 시스템

> AI 기반 의료진 협업 피드백 분석 및 대시보드 시스템

**버전**: 3.3
**업데이트**: 2025-10-22

---

## 📚 목차

1. [프로젝트 소개](#-프로젝트-소개)
2. [빠른 시작](#-빠른-시작-5분)
3. [프로젝트 구조](#-프로젝트-구조)
4. [상세 가이드](#-상세-가이드)
5. [문제 해결](#-문제-해결)

---

## 🎯 프로젝트 소개

서울아산병원 협업평가 시스템은 의료진 간 협업 피드백을 AI로 분석하고 인터랙티브 대시보드를 생성하는 시스템입니다.

### 주요 기능

- ✅ **AI 감정 분석**: Google Gemini API를 통한 텍스트 감정 분석
- ✅ **대시보드 생성**: 인터랙티브 HTML 대시보드 (연도별/반기별)
- ✅ **부서별 보고서**: 개별 부서 상세 보고서 생성
- ✅ **통계 분석**: 연도별/반기별 통계 리포트
- ✅ **외부망 대응**: 인터넷 연결 없이도 그래프 표시

### 핵심 스크립트

| 스크립트 | 기능 | 출력 |
|---------|------|------|
| `0. 데이터_정리.py` | 원본 데이터 수집 및 정제 | `rawdata/1. data_processor_결과_*.xlsx` |
| `0. 주관식_정제.py` | AI 기반 텍스트 감정 분석 | `rawdata/2. text_processor_결과_*.xlsx` |
| `1. 대시보드_연도_반기.py` | 통합 대시보드 생성 (연도별/반기별) | `*.html` |
| `4. 연도별_통계분석.py` | 연도별 통계 분석 | `연도별_통계분석.xlsx` |
| `5. 반기별_통계분석.py` | 반기별 통계 분석 | `반기별_통계분석.xlsx` |
| `6. 상호평가_부서추출_연도_반기.py` | 부서별 상호평가 데이터 추출 | `상호평가_부서추출*.xlsx` |
| `7. 진단_데이터정제표.py` | 데이터 품질 진단 | `진단_데이터정제표.xlsx` |

---

## 🚀 빠른 시작 (5분)

### 전제 조건

- Python 3.8 이상
- Google Gemini API 인증 파일 (`Gemini API.json`)
- 처리된 데이터 파일 (`rawdata/2. text_processor_결과_*.xlsx`)

### 실행 방법

```bash
# 1️⃣ 전체 병원 통합 대시보드 (연도별)
python3 "1. 대시보드_연도_반기.py"
# 출력: 서울아산병원 협업평가 결과.html

# 2️⃣ 반기별 분할 대시보드
python3 "1. 대시보드_연도_반기.py" --split
# 출력: 협업평가 결과_반기별.html

# 3️⃣ 특정 부서 개별 보고서
python3 "1. 대시보드_연도_반기.py" --department "암병원간호1팀" --division "간호부문"
# 출력: 서울아산병원 협업평가 결과.html (해당 부서만)

# 4️⃣ 모든 부서 개별 보고서 일괄 생성
python3 "1. 대시보드_연도_반기.py" --all-departments
# 출력: 개별보고서/[부문명]/[부서명].html
```

### 보고서 생성 옵션

| 옵션 | 설명 | 예시 |
|------|------|------|
| (기본) | 전체 병원 통합 보고서 | `python3 "1. 대시보드_연도_반기.py"` |
| `--split` | 2025년 상하반기 분리 | `--split` |
| `--department` | 특정 부서 보고서 | `--department "부서명" --division "부문명"` |
| `--all-departments` | 모든 부서 개별 보고서 | `--all-departments` |

---

## 📁 프로젝트 구조

### 디렉토리 구조

```
team-review-project/
├── src/                            # 공통 모듈
│   ├── __init__.py
│   ├── common.py                   # 공통 유틸리티 함수
│   └── config.py                   # 설정 관리
│
├── 0. 데이터_정리.py                # 원본 데이터 수집 및 정제
├── 0. 주관식_정제.py                # AI 텍스트 감정 분석
├── 1. 대시보드_연도_반기.py          # 통합 대시보드 생성
├── 4. 연도별_통계분석.py            # 연도별 통계
├── 5. 반기별_통계분석.py            # 반기별 통계
├── 6. 상호평가_부서추출_연도_반기.py  # 부서별 데이터 추출
├── 7. 진단_데이터정제표.py          # 데이터 품질 진단
│
├── rawdata/                        # 원본 및 처리된 데이터
│   ├── 설문조사진행현황[VCRCRIC120S]_2022_1.xlsx
│   ├── 설문조사진행현황[VCRCRIC120S]_2023_1.xlsx
│   ├── 설문조사진행현황[VCRCRIC120S]_2023_2.xlsx
│   ├── 설문조사진행현황[VCRCRIC120S]_2024_1.xlsx
│   ├── 설문조사진행현황[VCRCRIC120S]_2025_1.xlsx
│   ├── 설문조사진행현황[VCRCRIC120S]_2025_2.xlsx
│   ├── 부서_부문_매핑.xlsx
│   ├── 부서명_표준화_매핑.xlsx
│   ├── 데이터_수정_이력.xlsx
│   ├── 1. data_processor_결과_*.xlsx
│   └── 2. text_processor_결과_*.xlsx
│
├── 개별보고서/                      # 부서별 보고서 출력
│   └── [부문명]/
│       └── [부서명].html
│
├── venv/                           # Python 가상환경
└── README.md                       # 프로젝트 문서
```

### 핵심 파일 설명

#### 데이터 처리 스크립트

**0. 데이터_정리.py** (597줄)
- 역할: Google Sheets 데이터 수집 및 전처리
- 기능: 부서-부문 매핑, 부서명 표준화, 점수 계산
- 출력: `rawdata/1. data_processor_결과_*.xlsx`

**0. 주관식_정제.py**
- 역할: AI 기반 주관식 텍스트 분석
- 기능: Gemini API를 통한 감정 분석, 키워드 추출
- 출력: `rawdata/2. text_processor_결과_*.xlsx`

#### 대시보드 생성

**1. 대시보드_연도_반기.py** (2,669줄)
- 역할: 통합 대시보드 및 부서별 보고서 생성
- 기능:
  - 전체 병원 통합 대시보드
  - 반기별 분리 대시보드 (--split)
  - 특정 부서 보고서 (--department)
  - 전체 부서 개별 보고서 (--all-departments)
- 출력: HTML 대시보드

#### 통계 분석

**4. 연도별_통계분석.py**
- 역할: 연도별 협업 평가 통계 분석
- 출력: `연도별_통계분석.xlsx`

**5. 반기별_통계분석.py**
- 역할: 반기별 협업 평가 통계 분석
- 출력: `반기별_통계분석.xlsx`

#### 데이터 추출 및 진단

**6. 상호평가_부서추출_연도_반기.py**
- 역할: 부서별 상호평가 데이터 추출
- 출력: `상호평가_부서추출*.xlsx`

**7. 진단_데이터정제표.py**
- 역할: 데이터 품질 진단 및 검증
- 출력: `진단_데이터정제표.xlsx`

#### 공통 모듈 (src/)

**src/common.py**
- 공통 유틸리티 함수
- 최신 파일 자동 감지
- 안전한 데이터 파싱

**src/config.py**
- 공통 설정 관리
- 파일 경로, 컬럼명 정의
- 점수 항목 표준화

---

## 📖 상세 가이드

### 설치

#### 1. 필수 도구 설치

**Python 3.8+**
```bash
# Ubuntu/WSL
sudo apt update
sudo apt install python3 python3-pip python3-venv
python3 --version  # 확인
```

**필수 패키지**
```bash
# 가상환경 생성 및 활성화
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 패키지 설치
pip install pandas numpy plotly openpyxl tqdm
pip install google-generativeai  # Gemini API
```

#### 2. Google Gemini API 인증 설정

1. Google AI Studio에서 API 키 발급
2. `Gemini API.json` 파일을 프로젝트 루트에 저장
3. 환경 변수 설정 (선택):
```bash
export GOOGLE_APPLICATION_CREDENTIALS="./Gemini API.json"
```

#### 3. 데이터 준비

**옵션 A: 이미 처리된 데이터가 있는 경우**
- `rawdata/2. text_processor_결과_*.xlsx` 확인
- → 바로 보고서 생성 가능!

**옵션 B: 새 데이터 수집이 필요한 경우**
```bash
# 1단계: 데이터 수집 및 정제
python3 "0. 데이터_정리.py"

# 2단계: AI 감정 분석
python3 "0. 주관식_정제.py"
```

### 사용법

#### 시나리오 1: 전체 병원 통합 대시보드

```bash
python3 "1. 대시보드_연도_반기.py"
```

**출력**:
- `서울아산병원 협업평가 결과.html`
- 2025년 전체 기간 통합
- 약 10-15초 소요

**사용 상황**:
- 병원 전체 협업 현황을 한눈에 보고 싶을 때
- 경영진 보고용
- 연간 협업 트렌드 분석

#### 시나리오 2: 상반기/하반기 비교

```bash
python3 "1. 대시보드_연도_반기.py" --split
```

**출력**:
- `협업평가 결과_반기별.html`
- 2025년 상반기/하반기 구분 표시
- 약 10-15초 소요

**사용 상황**:
- 반기별 성과 비교
- 개선 추이 확인
- 계절적 변화 분석

#### 시나리오 3: 특정 부서 보고서

```bash
python3 "1. 대시보드_연도_반기.py" \
  --department "암병원간호1팀" \
  --division "간호부문"
```

**출력**:
- `서울아산병원 협업평가 결과.html` (해당 부서 데이터만)

**사용 상황**:
- 특정 부서 상세 분석
- 부서장 개별 리포트

#### 시나리오 4: 모든 부서 개별 보고서

```bash
python3 "1. 대시보드_연도_반기.py" --all-departments
```

**출력**:
- `개별보고서/[부문명]/[부서명].html`
- 약 1-2분 소요

**출력 구조 예시**:
```
개별보고서/
├── 간호부문/
│   ├── 암병원간호1팀.html
│   ├── 암병원간호2팀.html
│   └── ...
├── 진료부문/
│   ├── 영상의학팀.html
│   └── ...
└── 커뮤니케이션실/
    ├── 고객만족팀.html
    └── ...
```

**사용 상황**:
- 각 부서장에게 개별 보고서 전달
- 부서별 맞춤 분석

#### 시나리오 5: 통계 분석

```bash
# 연도별 통계
python3 "4. 연도별_통계분석.py"

# 반기별 통계
python3 "5. 반기별_통계분석.py"
```

**출력**:
- `연도별_통계분석.xlsx`
- `반기별_통계분석.xlsx`

**사용 상황**:
- 수치 기반 심층 분석
- Excel 기반 추가 분석

### 데이터 처리 흐름

```
원본 설문조사 파일 (rawdata/*.xlsx)
    ↓
0. 데이터_정리.py 실행
    ↓
부서-부문 매핑, 점수 계산, 데이터 정제
    ↓
1. data_processor_결과.xlsx 생성
    ↓
0. 주관식_정제.py 실행
    ↓
Gemini API로 텍스트 감정 분석
    ↓
2. text_processor_결과.xlsx 생성
    ↓
1. 대시보드_연도_반기.py 실행
    ↓
HTML 대시보드 생성
```

### 부서-부문 매핑 시스템

#### 매핑 파일 구조

**부서_부문_매핑.xlsx**
- 컬럼: `부문`, `부서명`, `소속UNIT`
- 역할: 부서를 부문으로 그룹화

**부서명_표준화_매핑.xlsx**
- 컬럼: `변경전_부서명`, `표준_부서명`
- 역할: 부서명 변경 이력 관리

#### 매핑 우선순위

1. **부서명 + Unit 완전 일치** → 해당 부문
2. **부서명만 일치 (Unit 없음)** → 기본 부문
3. **부서명 일치 + Unit 불일치** → '미분류'
4. **부서명 없음** → '미분류'

**예시**:
- 암병원간호1팀 + 62 Unit → 간호부문 ✅
- 암병원간호1팀 + (Unit 없음) → 간호부문 ✅
- 암병원간호1팀 + 999 Unit → 미분류 ⚠️

### 유지보수 가이드

#### 대시보드 수정
→ `1. 대시보드_연도_반기.py` 수정

#### 공통 설정 변경
→ `src/config.py` 또는 `src/common.py` 수정

#### 새 데이터 수집
→ `0. 데이터_정리.py` → `0. 주관식_정제.py` 순서로 실행

#### 부서-부문 매핑 업데이트
→ `rawdata/부서_부문_매핑.xlsx` 수정 후 재실행

---

## ❓ 문제 해결

### 자주 발생하는 문제

#### 1. `ModuleNotFoundError: No module named 'xxx'`

**원인**: 패키지가 설치되지 않음

**해결**:
```bash
pip install pandas numpy plotly openpyxl tqdm google-generativeai
```

#### 2. Google Gemini API 인증 오류

**원인**: API 키 설정 문제

**해결**:
```bash
# Gemini API.json 파일 확인
ls -lh "Gemini API.json"

# 파일 내용 확인 (API 키가 있는지)
cat "Gemini API.json"
```

#### 3. 파일을 찾을 수 없음

**원인**: `rawdata/` 폴더에 데이터 파일이 없음

**해결**:
```bash
# 파일 확인
ls rawdata/2.*text_processor*.xlsx

# 없으면 데이터 수집 실행
python3 "0. 데이터_정리.py"
python3 "0. 주관식_정제.py"
```

#### 4. 부서별 보고서 생성 실패

**원인**: 부서명 또는 부문명 오류

**해결**:
```bash
# 정확한 부서명 확인
python3 -c "
import pandas as pd
df = pd.read_excel('rawdata/부서_부문_매핑.xlsx')
print(df[['부문', '부서명']].drop_duplicates())
"
```

#### 5. 파일명에 공백이 있어서 실행 안 됨

**해결**:
```bash
# 따옴표로 감싸기
python3 "1. 대시보드_연도_반기.py"
```

#### 6. 부서_부문_매핑.xlsx 관련 오류

**증상**: "암병원간호1팀 62 Unit을 찾을 수 없음"

**해결**:
```bash
# 매핑 파일 확인
python3 -c "
import pandas as pd
df = pd.read_excel('rawdata/부서_부문_매핑.xlsx')
result = df[df['부서명'].str.contains('암병원간호1팀', na=False)]
print(result)
"
```

### 성능 최적화

#### 메모리 부족 시

**증상**: `MemoryError` 또는 프로세스 중단

**해결**:
```python
# 불필요한 컬럼 제거
df = df[['필요한', '컬럼만']]

# 데이터 타입 최적화
df['컬럼명'] = df['컬럼명'].astype('category')
```

#### 느린 실행 속도

**해결**:
```bash
# --split 옵션 제거 (필요 없는 경우)
python3 "1. 대시보드_연도_반기.py"

# --all-departments 대신 특정 부서만
python3 "1. 대시보드_연도_반기.py" --department "부서명" --division "부문명"
```

---

## 📞 지원 및 문의

### 프로젝트 정보

- **프로젝트**: 서울아산병원 협업평가 시스템
- **버전**: 3.3
- **최종 업데이트**: 2025-10-22
- **Python 버전**: 3.8+

### 기술 스택

- **언어**: Python 3.8+
- **데이터 처리**: pandas, numpy
- **시각화**: plotly
- **AI**: Google Gemini API (구 Vertex AI)
- **환경**: WSL2 (Ubuntu), VS Code

---

## 📝 변경 이력

### v3.3 (2025-10-22)
- rawdata에 processor 결과 파일 추가 (Git 추적)
- Vertex AI → Gemini API 완전 마이그레이션
- 부서별 보고서의 팀 랭킹 차트 버그 수정
- 부서_부문_매핑.xlsx 상세 매핑 분석 기능 추가
- README.md 구조 및 내용 전면 개편

### v3.2 (2025-10-14)
- 프로젝트 구조 최적화
- 빌드 스크립트 한글화
- 문서 통합 (README.md)
- 2022년 ~ 2024년 외과간호x팀 가정간호Unit 팀명을 암병원간호1팀으로 변경

### v3.1 (2025-10-14)
- 부서별 보고서 생성기 추가
- legacy 폴더를 참조용으로 변경

### v3.0 (2025-10-14)
- src 구조로 통합
- 모든 기능을 src 폴더로 이동
- 공통 모듈화 (common.py, config.py)

---

## 📄 라이선스

이 프로젝트는 서울아산병원 내부용으로 제작되었습니다.

---

**작성**: Claude AI
**유지보수**: 서울아산병원
