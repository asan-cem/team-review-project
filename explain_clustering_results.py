import pandas as pd
import numpy as np

def explain_clustering_results():
    """í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ ìƒì„¸ ì„¤ëª…"""
    
    print("ğŸ” í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ ìƒì„¸ ì„¤ëª…")
    print("=" * 60)
    
    try:
        # í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ íŒŒì¼ ì½ê¸°
        df = pd.read_excel('í˜‘ì—…í›„ê¸°_ë¶„ì„ê²°ê³¼_í´ëŸ¬ìŠ¤í„°ë§í¬í•¨_ìƒìœ„200ê±´.xlsx', 
                          sheet_name='í´ëŸ¬ìŠ¤í„°ë³„ìš”ì•½', engine='openpyxl')
        
        print("ğŸ“Š 1. ê·¸ë£¹ ì´ë¦„ ëª…ëª… ê¶Œì¥ì‚¬í•­")
        print("-" * 40)
        
        # í˜„ì¬ ê·¸ë£¹ë³„ íŠ¹ì„± ë¶„ì„
        group_recommendations = {
            'ê·¸ë£¹1': 'ì—…ë¬´í˜‘ì¡°ê°ì‚¬ê·¸ë£¹',
            'ê·¸ë£¹2': 'ì—…ë¬´ì§€ì›ìš”ì²­ê·¸ë£¹', 
            'ê·¸ë£¹3': 'ì¼ë°˜ê°ì‚¬í‘œí˜„ê·¸ë£¹',
            'ê·¸ë£¹4': 'ê²€ì‚¬í™˜ìì¼€ì–´ê·¸ë£¹',
            'ê·¸ë£¹5': 'ì¢…í•©ë§Œì¡±í‰ê°€ê·¸ë£¹',
            'ê·¸ë£¹6': 'í™˜ìì¤‘ì‹¬ì—…ë¬´ê·¸ë£¹',
            'ê·¸ë£¹7': 'ì²˜ë°©ë§Œì¡±ê·¸ë£¹'
        }
        
        for i, row in df.iterrows():
            current_name = row['í´ëŸ¬ìŠ¤í„°ê·¸ë£¹']
            recommended_name = group_recommendations.get(current_name, current_name)
            keywords = row['ì£¼ìš”í‚¤ì›Œë“œ']
            count = row['í”¼ë“œë°±ìˆ˜']
            
            print(f"{current_name} â†’ '{recommended_name}' ({count}ê±´)")
            print(f"  í‚¤ì›Œë“œ: {keywords}")
            print(f"  ì„¤ëª…: {get_group_description(current_name)}")
            print()
        
    except Exception as e:
        print(f"íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: {e}")

def get_group_description(group_name):
    """ê·¸ë£¹ë³„ ì„¤ëª…"""
    descriptions = {
        'ê·¸ë£¹1': 'ì—…ë¬´ í˜‘ì¡°ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê°ì‚¬ í‘œí˜„',
        'ê·¸ë£¹2': 'ì—…ë¬´ ì§€ì› ìš”ì²­ ë° í˜‘ì—… ê´€ë ¨ í”¼ë“œë°±',
        'ê·¸ë£¹3': 'ì¼ë°˜ì ì¸ ê°ì‚¬ í‘œí˜„ ë° ì¹œì ˆ ê´€ë ¨ í”¼ë“œë°± (ê°€ì¥ í° ê·¸ë£¹)',
        'ê·¸ë£¹4': 'ê²€ì‚¬ ë° í™˜ì ì¼€ì–´ ê´€ë ¨ êµ¬ì²´ì  í”¼ë“œë°±',
        'ê·¸ë£¹5': 'ì „ë°˜ì ì¸ ë§Œì¡±ë„ì— ëŒ€í•œ ì¢…í•© í‰ê°€',
        'ê·¸ë£¹6': 'í™˜ì ì¤‘ì‹¬ ì—…ë¬´ì— ëŒ€í•œ í”¼ë“œë°±',
        'ê·¸ë£¹7': 'ì²˜ë°© ê´€ë ¨ ì—…ë¬´ ë§Œì¡±ë„ í‘œí˜„'
    }
    return descriptions.get(group_name, 'ì„¤ëª… ì—†ìŒ')

def explain_similarity_pairs():
    """ìœ ì‚¬ í”¼ë“œë°± ìŒ ìƒì„¸ ì„¤ëª…"""
    
    print("\nğŸ“ 2. ìœ ì‚¬ í”¼ë“œë°± ìŒ ìƒì„¸ ì„¤ëª…")
    print("-" * 40)
    
    try:
        # ìœ ì‚¬ í”¼ë“œë°± ìŒ ë°ì´í„° ì½ê¸°
        pairs_df = pd.read_excel('í˜‘ì—…í›„ê¸°_ë¶„ì„ê²°ê³¼_í´ëŸ¬ìŠ¤í„°ë§í¬í•¨_ìƒìœ„200ê±´.xlsx', 
                               sheet_name='ìœ ì‚¬í”¼ë“œë°±ìŒ', engine='openpyxl')
        
        print("ğŸ”„ 'ìŒ(Pair)'ì´ë€?")
        print("  - ë‘ ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ í”¼ë“œë°±ì„ ë¹„êµí•œ ê²ƒ")
        print("  - ì˜ˆ: í”¼ë“œë°± Aì™€ í”¼ë“œë°± Bê°€ ì–¼ë§ˆë‚˜ ë¹„ìŠ·í•œì§€ ì¸¡ì •")
        print()
        
        print("ğŸ“Š ìœ ì‚¬ë„ ì¸¡ì • ë°©ë²•:")
        print("  - 0.0 = ì™„ì „íˆ ë‹¤ë¦„")
        print("  - 0.3 = 30% ìœ ì‚¬ (ì˜ë¯¸ìˆëŠ” ìœ ì‚¬ì„±)")
        print("  - 1.0 = ì™„ì „íˆ ë™ì¼")
        print()
        
        print("ğŸ¯ ì¤‘ë³µ ì´ìŠˆ ê°€ëŠ¥ì„±ì´ë€?")
        print("  - ë¹„ìŠ·í•œ ë‚´ìš©ì˜ í”¼ë“œë°±ì´ ì—¬ëŸ¬ ë²ˆ ì œê¸°ë¨")
        print("  - ê°™ì€ ë¬¸ì œì— ëŒ€í•œ ë°˜ë³µì ì¸ ë¶ˆë§Œ/ì œì•ˆ")
        print("  - ì¡°ì§ ì°¨ì›ì—ì„œ ìš°ì„ ì ìœ¼ë¡œ í•´ê²°í•´ì•¼ í•  ê³µí†µ ì´ìŠˆ")
        print()
        
        # ìƒìœ„ ìœ ì‚¬ë„ ì˜ˆì‹œ í‘œì‹œ
        print("ğŸ“‹ ìœ ì‚¬ë„ ë†’ì€ í”¼ë“œë°± ì˜ˆì‹œ (ìƒìœ„ 5ê°œ):")
        top_pairs = pairs_df.nlargest(5, 'ìœ ì‚¬ë„')
        
        for i, row in top_pairs.iterrows():
            print(f"\n{i+1}. ìœ ì‚¬ë„: {row['ìœ ì‚¬ë„']}")
            print(f"   í”¼ë“œë°±1: {row['í…ìŠ¤íŠ¸1']}")
            print(f"   í”¼ë“œë°±2: {row['í…ìŠ¤íŠ¸2']}")
            print(f"   â†’ ë‘˜ ë‹¤ '{row['í´ëŸ¬ìŠ¤í„°1']}' ê·¸ë£¹ì— ì†í•¨" if row['í´ëŸ¬ìŠ¤í„°1'] == row['í´ëŸ¬ìŠ¤í„°2'] 
                  else f"   â†’ ê°ê° '{row['í´ëŸ¬ìŠ¤í„°1']}'ê³¼ '{row['í´ëŸ¬ìŠ¤í„°2']}' ê·¸ë£¹")
        
        # í†µê³„ ì •ë³´
        print(f"\nğŸ“ˆ ìœ ì‚¬ í”¼ë“œë°± í†µê³„:")
        print(f"  - ì´ {len(pairs_df)}ê°œ ìŒì´ 30% ì´ìƒ ìœ ì‚¬")
        print(f"  - í‰ê·  ìœ ì‚¬ë„: {pairs_df['ìœ ì‚¬ë„'].astype(float).mean():.3f}")
        print(f"  - ìµœê³  ìœ ì‚¬ë„: {pairs_df['ìœ ì‚¬ë„'].astype(float).max():.3f}")
        
        # ê°™ì€ í´ëŸ¬ìŠ¤í„° ë‚´ vs ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„° ê°„
        same_cluster = pairs_df[pairs_df['í´ëŸ¬ìŠ¤í„°1'] == pairs_df['í´ëŸ¬ìŠ¤í„°2']]
        diff_cluster = pairs_df[pairs_df['í´ëŸ¬ìŠ¤í„°1'] != pairs_df['í´ëŸ¬ìŠ¤í„°2']]
        
        print(f"  - ê°™ì€ ê·¸ë£¹ ë‚´ ìœ ì‚¬ ìŒ: {len(same_cluster)}ê°œ")
        print(f"  - ë‹¤ë¥¸ ê·¸ë£¹ ê°„ ìœ ì‚¬ ìŒ: {len(diff_cluster)}ê°œ")
        
        return pairs_df
        
    except Exception as e:
        print(f"ìœ ì‚¬ í”¼ë“œë°± ë¶„ì„ ì˜¤ë¥˜: {e}")
        return None

def explain_dashboard_possibilities():
    """ëŒ€ì‹œë³´ë“œ êµ¬í˜„ ê°€ëŠ¥ì„± ì„¤ëª…"""
    
    print("\nğŸ“Š 3. ëŒ€ì‹œë³´ë“œ ë° ê°œë³„ ë³´ê³ ì„œ êµ¬í˜„ ê°€ëŠ¥ì„±")
    print("-" * 50)
    
    try:
        # ë©”ì¸ ë°ì´í„° ì½ê¸°
        main_df = pd.read_excel('í˜‘ì—…í›„ê¸°_ë¶„ì„ê²°ê³¼_í´ëŸ¬ìŠ¤í„°ë§í¬í•¨_ìƒìœ„200ê±´.xlsx', 
                              sheet_name='ë¶„ì„ê²°ê³¼_í´ëŸ¬ìŠ¤í„°í¬í•¨', engine='openpyxl')
        
        print("âœ… í˜„ì¬ ë°ì´í„°ë¡œ êµ¬í˜„ ê°€ëŠ¥í•œ ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥:")
        print()
        
        print("1ï¸âƒ£ ë¶€ë¬¸ë³„ ë¶„ì„")
        ë¶€ë¬¸_ë¶„í¬ = main_df['í‰ê°€_ë¶€ë¬¸'].value_counts()
        print(f"   - ì´ {len(ë¶€ë¬¸_ë¶„í¬)}ê°œ ë¶€ë¬¸")
        for ë¶€ë¬¸, ê±´ìˆ˜ in ë¶€ë¬¸_ë¶„í¬.head().items():
            print(f"     â€¢ {ë¶€ë¬¸}: {ê±´ìˆ˜}ê±´")
        print()
        
        print("2ï¸âƒ£ í‰ê°€ ë¶€ì„œë³„ ë¶„ì„")
        ë¶€ì„œ_ë¶„í¬ = main_df['í‰ê°€_ë¶€ì„œëª…'].value_counts()
        print(f"   - ì´ {len(ë¶€ì„œ_ë¶„í¬)}ê°œ í‰ê°€ ë¶€ì„œ")
        for ë¶€ì„œ, ê±´ìˆ˜ in ë¶€ì„œ_ë¶„í¬.head().items():
            print(f"     â€¢ {ë¶€ì„œ}: {ê±´ìˆ˜}ê±´")
        print()
        
        print("3ï¸âƒ£ í”¼í‰ê°€ ë¶€ì„œë³„ ë¶„ì„")
        í”¼í‰ê°€_ë¶„í¬ = main_df['í”¼í‰ê°€ëŒ€ìƒ ë¶€ì„œëª…'].value_counts()
        print(f"   - ì´ {len(í”¼í‰ê°€_ë¶„í¬)}ê°œ í”¼í‰ê°€ ë¶€ì„œ")
        for ë¶€ì„œ, ê±´ìˆ˜ in í”¼í‰ê°€_ë¶„í¬.head().items():
            print(f"     â€¢ {ë¶€ì„œ}: {ê±´ìˆ˜}ê±´")
        print()
        
        print("4ï¸âƒ£ ê°ì • ë¶„ì„ ê²°ê³¼")
        ê°ì •_ë¶„í¬ = main_df['í˜‘ì—…í›„ê¸°_ì£¼ê°ì •'].value_counts()
        for ê°ì •, ê±´ìˆ˜ in ê°ì •_ë¶„í¬.items():
            print(f"   - {ê°ì •}: {ê±´ìˆ˜}ê±´ ({ê±´ìˆ˜/len(main_df)*100:.1f}%)")
        print()
        
        print("5ï¸âƒ£ í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ë³„ ë¶„ì„")
        ê·¸ë£¹_ë¶„í¬ = main_df['í˜‘ì—…í›„ê¸°_í´ëŸ¬ìŠ¤í„°ê·¸ë£¹'].value_counts()
        for ê·¸ë£¹, ê±´ìˆ˜ in ê·¸ë£¹_ë¶„í¬.items():
            if pd.notna(ê·¸ë£¹):
                print(f"   - {ê·¸ë£¹}: {ê±´ìˆ˜}ê±´")
        print()
        
        print("ğŸ¯ ê°œë³„ ë³´ê³ ì„œ ìƒì„± ê°€ëŠ¥ í˜•íƒœ:")
        print("   ğŸ“‹ ë¶€ë¬¸ë³„ ë³´ê³ ì„œ: ê° ë¶€ë¬¸ì˜ ê°ì • ë¶„í¬, ì£¼ìš” ì´ìŠˆ, í´ëŸ¬ìŠ¤í„° ë¶„ì„")
        print("   ğŸ“‹ ë¶€ì„œë³„ ë³´ê³ ì„œ: í‰ê°€/í”¼í‰ê°€ ë¶€ì„œë³„ ìƒì„¸ ë¶„ì„")
        print("   ğŸ“‹ Unitë³„ ë³´ê³ ì„œ: Unit ë‹¨ìœ„ ì„±ê³¼ ë° ê°œì„ ì  ë¶„ì„")
        print("   ğŸ“‹ ì‹œê³„ì—´ ë³´ê³ ì„œ: ì„¤ë¬¸ ì‹œí–‰ ì—°ë„ë³„ ë³€í™” ì¶”ì„¸")
        print("   ğŸ“‹ í´ëŸ¬ìŠ¤í„°ë³„ ë³´ê³ ì„œ: ê·¸ë£¹ë³„ íŠ¹ì„± ë° ëŒ€ì‘ ë°©ì•ˆ")
        
        return main_df
        
    except Exception as e:
        print(f"ëŒ€ì‹œë³´ë“œ ë¶„ì„ ì˜¤ë¥˜: {e}")
        return None

if __name__ == "__main__":
    explain_clustering_results()
    explain_similarity_pairs()
    explain_dashboard_possibilities()